<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>₿AZAR TCM — {{ category }}</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<header>
  <h1>₿AZAR TCM — {{ category }}</h1>
</header>

<div class="filters">
  <input type="text" id="searchInput" placeholder="Поиск...">
  <select id="filterCondition">
    <option value="">Все состояния</option>
    <option value="new">Новое</option>
    <option value="used">С пробегом</option>
  </select>
  <input type="number" id="priceMin" placeholder="Цена от">
  <input type="number" id="priceMax" placeholder="Цена до">
  <button onclick="applyFilters()">Найти</button>
</div>

<section class="ads-container" id="adsContainer">
  <!-- Объявления -->
</section>

<footer>
  <p>₿AZAR TCM — рынок без границ © 2025</p>
</footer>

<script>
let ADS = {{ ads|tojson|safe }};

function renderAds(list){
  const container = document.getElementById('adsContainer');
  container.innerHTML = '';
  if(!list.length){
    container.innerHTML = '<p>Объявления не найдены</p>';
    return;
  }
  list.forEach(ad=>{
    const div=document.createElement('div');
    div.className='ad';
    div.innerHTML=`<strong>${ad.title}</strong><br>${ad.price} ${ad.currency}<br>${ad.user} | ${ad.date} | ${ad.condition==='new'?'Новое':'С пробегом'}`;
    container.appendChild(div);
  });
}

function applyFilters(){
  const q = document.getElementById('searchInput').value.toLowerCase();
  const cond = document.getElementById('filterCondition').value;
  const min = Number(document.getElementById('priceMin').value) || 0;
  const max = Number(document.getElementById('priceMax').value) || Infinity;

  const filtered = ADS.filter(ad=>{
    const text = (ad.title+' '+ad.user).toLowerCase();
    const priceNum = Number(ad.price.replace(/\s/g,''));
    let ok = text.includes(q) && priceNum>=min && priceNum<=max;
    if(cond) ok = ok && ad.condition===cond;
    return ok;
  });
  renderAds(filtered);
}

renderAds(ADS);
</script>
</body>
</html>
